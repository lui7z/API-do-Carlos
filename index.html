<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>InfoNow - Painel Din√¢mico</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  
  <script src="login.js"></script>
  <script src="https://cdn.auth0.com/js/auth0-spa-js/1.19/auth0-spa-js.production.js"></script>

  <style>
    body {
      background: #f8f9fa;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      padding: 2rem 1rem;
      background: #0d6efd;
      color: white;
      text-align: center;
      font-weight: 700;
      font-size: 1.8rem;
    }
    .card {
      box-shadow: 0 4px 12px rgb(0 0 0 / 0.1);
      border-radius: 0.8rem;
      transition: transform 0.2s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgb(0 0 0 / 0.15);
    }
    .icon {
      font-size: 2.5rem;
      color: #0d6efd;
    }
    #currencyInfo > div > div {
      background: white;
      border-radius: 0.5rem;
      box-shadow: 0 2px 6px rgb(0 0 0 / 0.1);
      padding: 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .movie-item {
      display: flex;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid #eee;
    }
    .movie-item:last-child {
      border-bottom: none;
    }
    .movie-poster {
      width: 50px;
      height: 75px;
      object-fit: cover;
      margin-right: 1rem;
      border-radius: 4px;
    }
    .country-flag {
      width: 40px;
      height: auto;
      margin-right: 10px;
      border: 1px solid #ddd;
    }
    .movie-rating {
      color: #ffc107;
      font-weight: bold;
    }

    /* -------------------------------- */
    /* Parte do Luizinho */

    .dropbox {
      width: 75%;
    }

    #drop-zone {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      border: 2px dashed #0d6efd;
      border-radius: 10px;
      height: 250px;
      justify-content: center;
      padding: 20px;
      cursor: pointer;
      background-color: #f1f1f1;
      transition: background 0.3s ease-in-out;
    }

    #drop-zone:hover {
      background-color: #e0e0e0;
    }

    #file-input {
      display: none;
    }

    #dboxenviar {
      width: 33%;
    }
  </style>
</head>
<body>

<header>
  üåê InfoNow - Informa√ß√µes Din√¢micas
  <button class="btn btn-secondary" onclick="logout()">Sair</button>
</header>

<main class="container my-4">
  <div class="row g-4 justify-content-center">
    <div class="col-md-5 col-lg-4">
      <div class="card p-4 text-center">
        <div><i class="bi bi-cloud-sun-fill icon"></i></div>
        <h3 class="my-3">Clima Atual</h3>
        <div id="weatherInfo" class="fs-5 text-secondary">Detectando localiza√ß√£o...</div>
      </div>
    </div>

    <div class="col-md-5 col-lg-4">
      <div class="card p-4">
        <div class="text-center mb-3">
          <i class="bi bi-currency-exchange icon"></i>
          <h3 class="mt-2">Cota√ß√£o (BRL)</h3>
        </div>
        <div id="currencyInfo" class="fs-5 text-secondary">Carregando cota√ß√µes...</div>
      </div>
    </div>

    <!-- Card: Informa√ß√µes sobre Pa√≠ses -->
    <div class="col-md-5 col-lg-4">
      <div class="card p-4">
        <div class="text-center mb-3">
          <i class="bi bi-globe-americas icon"></i>
          <h3 class="mt-2">Informa√ß√µes sobre Pa√≠ses</h3>
        </div>
        <div class="mb-3">
          <input type="text" id="countryInput" class="form-control" placeholder="Digite um pa√≠s (em ingl√™s)">
        </div>
        <button id="searchCountry" class="btn btn-primary w-100 mb-3">Buscar</button>
        <div id="countryInfo" class="fs-5 text-secondary">
          <p class="text-center">Digite um pa√≠s para pesquisar</p>
        </div>
      </div>
    </div>
  </div>
  <!-- Dropbox -->
  <div class="my-4 row g-4 justify-content-center">
    <div class="dropbox col-md-4 col-lg-4">
      <div class="card p-4">
        <div class="text-center mb-3">
          <i class="icon bi bi-dropbox"></i>
          <h3 class="mt-2">Adi√ß√£o de Arquivos na Nuvem</h3>
          <div id="drop-zone" style="border: 2px dashed #ccc; padding: 20px; text-align: center; cursor: pointer;">
            <p>Arraste os arquivos aqui ou clique para selecionar</p>
            <input type="file" id="file-input" style="display: none;">
          </div>
          <button id="dboxenviar" class="btn btn-primary w-100 mb-3 mt-3">Enviar</button>
        </div>
      </div>
    </div>
  </div>
</main>

<script src="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js"></script>
<script>
  const weatherCodes = {
  0: { desc: "C√©u limpo", emoji: "‚òÄÔ∏è" },
  1: { desc: "Principalmente limpo", emoji: "üå§Ô∏è" },
  2: { desc: "Parcialmente nublado", emoji: "‚õÖ" },
  3: { desc: "Nublado", emoji: "‚òÅÔ∏è" },
  45: { desc: "Neblina", emoji: "üå´Ô∏è" },
  48: { desc: "Dep√≥sito de gelo", emoji: "üå´Ô∏è" },
  51: { desc: "Chuvisco leve", emoji: "üå¶Ô∏è" },
  53: { desc: "Chuvisco moderado", emoji: "üå¶Ô∏è" },
  55: { desc: "Chuvisco denso", emoji: "üåßÔ∏è" },
  56: { desc: "Chuvisco congelante leve", emoji: "üåßÔ∏è‚ùÑÔ∏è" },
  57: { desc: "Chuvisco congelante denso", emoji: "üåßÔ∏è‚ùÑÔ∏è" },
  61: { desc: "Chuva leve", emoji: "üåßÔ∏è" },
  63: { desc: "Chuva moderada", emoji: "üåßÔ∏è" },
  65: { desc: "Chuva forte", emoji: "‚õàÔ∏è" },
  66: { desc: "Chuva congelante leve", emoji: "üåßÔ∏è‚ùÑÔ∏è" },
  67: { desc: "Chuva congelante forte", emoji: "üåßÔ∏è‚ùÑÔ∏è" },
  71: { desc: "Neve leve", emoji: "üå®Ô∏è" },
  73: { desc: "Neve moderada", emoji: "üå®Ô∏è" },
  75: { desc: "Neve forte", emoji: "‚ùÑÔ∏è" },
  77: { desc: "Granizo", emoji: "üå®Ô∏è" },
  80: { desc: "Chuva de pancadas leve", emoji: "üå¶Ô∏è" },
  81: { desc: "Chuva de pancadas forte", emoji: "üåßÔ∏è" },
  82: { desc: "Chuva de pancadas violenta", emoji: "‚õàÔ∏è" },
  85: { desc: "Neve de pancadas leve", emoji: "üå®Ô∏è" },
  86: { desc: "Neve de pancadas forte", emoji: "‚ùÑÔ∏è" },
  95: { desc: "Tempestade com trov√µes", emoji: "‚õàÔ∏è" },
  96: { desc: "Tempestade com trov√µes e granizo leve", emoji: "‚õàÔ∏è" },
  99: { desc: "Tempestade com trov√µes e granizo forte", emoji: "‚õàÔ∏è" },
};

// Fun√ß√£o para buscar clima
async function fetchWeather(lat, lon) {
  try {
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&temperature_unit=celsius`;
    const res = await fetch(url);
    if (!res.ok) throw new Error("Erro ao obter clima");
    const data = await res.json();
    return data.current_weather;
  } catch {
    return null;
  }
}

// Fun√ß√£o para buscar cota√ß√µesAdd commentMore actions
async function fetchCurrency() {
  try {
    const res = await fetch("https://api.frankfurter.app/latest?from=BRL&to=USD,EUR,GBP");
    if (!res.ok) throw new Error('Erro na cota√ß√£o');
    const data = await res.json();
    return data.rates;
  } catch {
    return null;
  }
}

// Fun√ß√£o para buscar informa√ß√µes de um pa√≠sAdd commentMore actions
async function fetchCountryInfo(countryName) {
  try {
    const res = await fetch(`https://restcountries.com/v3.1/name/${countryName}`);
    if (!res.ok) throw new Error('Pa√≠s n√£o encontrado');
    const data = await res.json();
    return data[0]; // Retorna o primeiro resultado
  } catch (error) {
    console.error("Erro ao buscar pa√≠s:", error);
    return null;
  }
}

// Atualiza o card do clima
async function updateWeather() {
  const weatherDiv = document.getElementById("weatherInfo");

  if (!navigator.geolocation) {
    weatherDiv.textContent = "Geolocaliza√ß√£o n√£o suportada.";
    return;
  }

  navigator.geolocation.getCurrentPosition(async (position) => {
    const { latitude, longitude } = position.coords;
    const weather = await fetchWeather(latitude, longitude);
    if (!weather) {
      weatherDiv.textContent = "N√£o foi poss√≠vel obter o clima.";
      return;
    }

    const code = weather.weathercode;
    const desc = weatherCodes[code]?.desc || "Desconhecido";
    const emoji = weatherCodes[code]?.emoji || "‚ùì";
    const temp = weather.temperature;

    weatherDiv.innerHTML = `
      <div style="font-size:3rem">${emoji}</div>
      <strong>Temperatura:</strong> ${temp.toFixed(1)} ¬∞C<br/>
      <strong>Condi√ß√£o:</strong> ${desc}
    `;
  }, () => {
    weatherDiv.textContent = "Permiss√£o para geolocaliza√ß√£o negada.";
  });
}

// Atualiza o card de cota√ß√µes
async function updateCurrency() {
  const currencyDiv = document.getElementById("currencyInfo");
  try {
    const res = await fetch("https://api.frankfurter.app/latest?from=BRL&to=USD,EUR,GBP");
    if (!res.ok) throw new Error("Erro na cota√ß√£o");
    const data = await res.json();
    const rates = data.rates;

    const currencies = {
      USD: { name: "D√≥lar Americano", emoji: "üíµ" },
      EUR: { name: "Euro", emoji: "üí∂" },
      GBP: { name: "Libra Esterlina", emoji: "üí∑" },
    };

    let html = '<div class="d-flex flex-column gap-3">';
    for (const code of Object.keys(currencies)) {
      const { name, emoji } = currencies[code];
      const value = rates[code];
      html += `
        <div>
          <div style="font-size:2.5rem">${emoji}</div>
          <div class="fw-bold">${name} (${code})</div>
          <div>1 BRL = <span class="text-primary">${value.toFixed(4)}</span> ${code}</div>
        </div>
      `;
    }
    html += "</div>";
    currencyDiv.innerHTML = html;
  } catch {
    currencyDiv.textContent = "Erro ao buscar cota√ß√µes.";
  }
}

// Configura o evento de busca de pa√≠sAdd commentMore actions
function setupCountrySearch() {
  const searchBtn = document.getElementById("searchCountry");
  const countryInput = document.getElementById("countryInput");
  const countryInfoDiv = document.getElementById("countryInfo");

  searchBtn.addEventListener("click", async () => {
    const countryName = countryInput.value.trim();
    if (!countryName) {
      countryInfoDiv.innerHTML = '<p class="text-center text-danger">Por favor, digite um pa√≠s</p>';
      return;
    }

    countryInfoDiv.innerHTML = `
      <div class="d-flex justify-content-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Carregando...</span>
        </div>
      </div>
    `;

    const country = await fetchCountryInfo(countryName);
    if (!country) {
      countryInfoDiv.innerHTML = '<p class="text-center text-danger">Pa√≠s n√£o encontrado</p>';
      return;
    }

    const languages = country.languages ? Object.values(country.languages).join(', ') : 'N√£o dispon√≠vel';
    const currencies = country.currencies ? Object.values(country.currencies).map(c => c.name).join(', ') : 'N√£o dispon√≠vel';

    countryInfoDiv.innerHTML = `
      <div class="text-center mb-3">
        <img src="${country.flags?.png}" alt="Bandeira" class="country-flag">
        <h4>${country.name?.common || countryName}</h4>
      </div>
      <div class="d-flex flex-column gap-2">
        <div><strong>Capital:</strong> ${country.capital?.[0] || 'N√£o dispon√≠vel'}</div>
        <div><strong>Continente:</strong> ${country.region || 'N√£o dispon√≠vel'}</div>
        <div><strong>Popula√ß√£o:</strong> ${country.population?.toLocaleString() || 'N√£o dispon√≠vel'}</div>
        <div><strong>Idiomas:</strong> ${languages}</div>
        <div><strong>Moedas:</strong> ${currencies}</div>
        <div><strong>Fuso Hor√°rio:</strong> ${country.timezones?.[0] || 'N√£o dispon√≠vel'}</div>
      </div>
    `;
  });
}

// ----------------------------------------------------------------------------------------------
// Dropbox

const dropZone = document.getElementById("drop-zone");
const fileInput = document.getElementById("file-input");
const uploadButton = document.getElementById("dboxenviar");

const UPLOAD_ACCESS_TOKEN = "sl.u.AFxdbWWz8QQmxF_OZf9_CkE_xhytt7_7TWgJJux4h5NiQ9YSSn46GZip0m4GlUA2JYpgrERTocJjzPLtu7lcf35A8WQb5dFfcs-1veHXBILcEpHC4ckzuww8LgOHij2T6q8JpONThgZo44n_iTjCHUjrYK4TiBX13DFcgT_dJWLPrjY0vzFt72gY0gtiE7D6NqOLv1rDWX1dHWl9KlamJxpS1RyXcQZyUcx0Dp-4UMTBq9J7H0EShhcSCe9D7uMVmCy2styE3yGfkcDGjW-PcAaJj83h_PAXVbDn-IK4kK8KZ2-18_IzRqfYN8TU97ynOooueZrbd-k9LoI3MRCJG3kk6HZeZ0td-WYHEhB5onjyYXinrI0Ton1ab97WQ6qrdEHBb_H64mi_AuUF16XC34z_UzGN2hYlPMgGye5RN0t5clyrWIkQnPiBxw8LSId0tJ0-Nz7OkuSf7HJVuGfOpygo4lrZwls7r_MknMzSfJBuuz-4cHh67-sav7BG6mvZ1_6H2t5mcVdJSbR8-Z70XsP2y9dtNx7zgO2ZqHXS9V8cxZpM5j2CT5AwCdAEOkzQt6LcxyULY7DkVAYTFrx81Y1TKVgeT4FQkPcu7ZWrSK4F2fZEqhhfp5JVbfW_LIngr92mWZEC0X1dXHwfip3IRhCANX085y3KN0tcbvOgSSbja-7MSscedj7fvTHWYsNfq790evywk_CUtXJjUkPQjsRrxQS2B2aUlWNAxj8Zo5Jei3C4_-CqNG8wCq2i8-vIAYRvgSp6sKqtrS8IZ8U1ShYhW0Za_nJleNsXNcHjqS3VdCq1IWtrMlY6vEXQfJtPXFP7tiDx-kFqgNSdO_IPszzsh_XMSkbUkjYLwqSYxv-k5ijAXiRGqljV8glvYtYSdDE1aSu6CfbQA42m3suArEkL6LPW4HK3UW42pzBzH2M1od_1x_ST8IQ9ud7TFD8up1QEP3XPcHyOFpc5HUTFBH0cjxTEMPVmR1RfzH8vDaGhPGJ5cAqf_Y67DkasDulsKTkuOdZ8LdiGEtgPZ_6PHvuQKPYV_XL67zFDqMMiyuPgaN-fECp5LBRmd9F6wL4PMFF0Fb22u5gwcKQykmMj0RO7i13S6WRbgk7soKjht7Rb5KhIFqwIHut2MJMlUG0lusMeCNRW3AiouZuocTKYHPvCs5k4yL9P49YfkXj5hn-gpqkvqqgH0iricn3QxYvQanwxQIzR2dQcqGfyu6IR7mAF_NhQV1v_ffb1c4g_ePrqfGsYXgnG0UUs6lk_NFYET3UIPXzyBfb65G5b6aKcYSK-WeWZ-XpE0IpHaLVp8tcHqbzeuBrwODIu5GlJCHL23Hlrwoi4Agc-PYjRMuJ9dDajnr646e1Zyjk5ayy8qkjWI6DBSVAXki23pmJ7kdiPo1XHDw8NG8Rq9czfwKBPDqmI25pDWqc0J847x50pSbWRug";

const dbx = new Dropbox.Dropbox({ accessToken: UPLOAD_ACCESS_TOKEN });

async function uploadFile(file) {
    if (!file) {
        alert("Por favor, selecione um arquivo para enviar.");
        return;
    }

    const filePath = "/Pastinha/" + file.name; 
    
    try {
        const response = await dbx.filesUpload({
            path: filePath,
            contents: file,
            mode: { ".tag": "add" }, 
            autorename: true,
            mute: false
        });

        console.log("Resposta da API Dropbox:", response);
        alert("Arquivo enviado com sucesso para o Dropbox!");
    } catch (error) {
        console.error("Erro ao enviar arquivo:", error);
        if (error.error && error.error.error_summary) {
            alert(`Erro ao enviar arquivo: ${error.error.error_summary}`);
        } else {
            alert("Erro ao enviar arquivo. Verifique o console para mais detalhes.");
        }
    }
}

// Event Listeners
dropZone.addEventListener("dragover", (e) => {
    e.preventDefault(); 
    dropZone.style.backgroundColor = "#e0e0e0"; 
});

dropZone.addEventListener("dragleave", () => {
    dropZone.style.backgroundColor = ""; 
});

dropZone.addEventListener("drop", (e) => {
    e.preventDefault();
    dropZone.style.backgroundColor = ""; 
    if (e.dataTransfer.files.length) {
        uploadFile(e.dataTransfer.files[0]);
    }
});

dropZone.addEventListener("click", () => {
    fileInput.click();
});

fileInput.addEventListener("change", (e) => {
    if (e.target.files.length) {
        uploadFile(e.target.files[0]);
    }
});

uploadButton.addEventListener("click", () => {
    if (fileInput.files.length) {
        uploadFile(fileInput.files[0]);
    } else {
        alert("Por favor, selecione um arquivo primeiro.");
    }
});

// -----------------------------------------------------------------------------------


// Inicializa tudo quando a p√°gina carrega
window.onload = () => {
  updateWeather();
  updateCurrency();
  setupCountrySearch();
};
</script>

</body>
</html>